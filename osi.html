<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detector de Objetos</title>
</head>

<body>
<h1>Detector de Objetos</h1>
<canvas id="canvas" width="1040" height="2000"></canvas><br />
<video id="video" width="1040" height="1000" autoplay muted></video>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

canvas.style.width = "2000px";

async function setupCamera() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        return new Promise((resolve) => {
            video.onloadedmetadata = () => {
                video.play();
                resolve();
            };
        });
    } catch (err) {
        console.error("No se pudo acceder a la cÃ¡mara:", err);
    }
}

async function runObjectDetection() {
    await setupCamera();
    const model = await cocoSsd.load();
    console.log("Modelo cargado");

    async function detectFrame() {
        const predictions = await model.detect(video);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(video, 0, 0);

        predictions.forEach(pred => {
            const [x, y, width, height] = pred.bbox;
            ctx.strokeStyle = "red";
            ctx.lineWidth = 2;
            ctx.strokeRect(x, y, width, height);
            ctx.font = "18px monospace";
            ctx.fillStyle = "blue";
            ctx.fillText(pred.class, x, y > 20 ? y - 5 : y + 20);
        });

        requestAnimationFrame(detectFrame);
    }

    detectFrame();
}

runObjectDetection();
</script>
</body>
